---
interface Props {
  path: string;
}

const { path } = Astro.props;

let views = 0;
try {
  // Fetch the current view count
  const response = await fetch('https://delicate-flower-cb99.daryll-santos.workers.dev');
  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }
  const data = await response.json() as Record<string, Record<string, number>>;
  const today = new Date().toISOString().split('T')[0];
  views = data[today]?.[path] || 0;
} catch (error) {
  console.error('Failed to fetch analytics:', error);
  // If there's an error, we'll just show 0 views
  views = 0;
}
---

<div class="text-sm text-gray-500 ml-4">
  <span>Views: {views}</span>
</div>

<script>
  import { trackPageView } from '../scripts/analytics';
  
  // Track the page view when the component mounts
  trackPageView();
</script> 